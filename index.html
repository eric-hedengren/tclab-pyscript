<head>
    <title>TCLab Web Demo</title>
    <script src="main.js"></script>
    <script src="smoothie.js"></script>
    <script>
        var line1 = new TimeSeries();

        setInterval(async function() {
            if (connected) {
                const value = await command('RT');
                if (value.length == 6 && !value.includes('\r') && !value.includes('\n') && value != '100.00') {
                    line1.append(Date.now(), value);
                }
            }
        }, 1000);

        function createChart() {
            var chart = new SmoothieChart({ responsive: true });
            chart.addTimeSeries(line1, {strokeStyle:'rgba(0, 255, 0, 1)', fillStyle:'rgba(0, 255, 0, 0.2)', lineWidth:4});
            chart.streamTo(document.getElementById("chart"), 1000);
        }
    </script>
</head>
<body onload="createChart()">
    <button onclick="connect()">Connect</button>
    <button onclick="command('HON')">Turn on Heater</button>
    <button onclick="command('HOF')">Turn off Heater</button>
    <button onclick="command('LON')">Turn on LED</button>
    <button onclick="command('LOF')">Turn off LED</button>
    <hr>
    <canvas id="chart" style="width:100%;height:150px" width="1000" height="150"></canvas>
</body>